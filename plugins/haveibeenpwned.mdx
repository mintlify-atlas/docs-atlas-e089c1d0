---
title: Have I Been Pwned
description: Prevent users from using compromised passwords with Have I Been Pwned integration
---

The Have I Been Pwned plugin integrates with the [Have I Been Pwned API](https://haveibeenpwned.com/) to check if passwords have been exposed in known data breaches. It automatically rejects compromised passwords during sign-up, password changes, and password resets.

## Security Benefits

- **Breach Detection**: Automatically checks passwords against a database of 850+ million compromised passwords
- **Privacy-Preserving**: Uses k-anonymity model - only sends the first 5 characters of the SHA-1 hash
- **Real-Time Protection**: Verifies passwords at the time of use, protecting against newly discovered breaches
- **Configurable Paths**: Choose which authentication endpoints to protect
- **Zero Configuration**: Works out of the box with sensible defaults

## Installation

<Steps>

<Step title="Add the plugin to your Better Auth configuration">

```ts title="auth.ts"
import { betterAuth } from "better-auth";
import { haveIBeenPwned } from "better-auth/plugins";

export const auth = betterAuth({
  plugins: [
    haveIBeenPwned(),
  ],
});
```

</Step>

</Steps>

That's it! No API keys or additional configuration required.

## Configuration

### Basic Usage

```ts title="auth.ts"
import { haveIBeenPwned } from "better-auth/plugins";

export const auth = betterAuth({
  plugins: [
    haveIBeenPwned(),
  ],
});
```

### Custom Error Message

```ts title="auth.ts"
import { haveIBeenPwned } from "better-auth/plugins";

export const auth = betterAuth({
  plugins: [
    haveIBeenPwned({
      customPasswordCompromisedMessage: "This password has been found in a data breach. Please choose a stronger, unique password.",
    }),
  ],
});
```

### Custom Protected Paths

By default, the plugin checks passwords on:
- `/sign-up/email`
- `/change-password`
- `/reset-password`

You can customize which paths to protect:

```ts title="auth.ts"
import { haveIBeenPwned } from "better-auth/plugins";

export const auth = betterAuth({
  plugins: [
    haveIBeenPwned({
      paths: [
        "/sign-up/email",
        "/change-password",
        // Add custom paths
      ],
    }),
  ],
});
```

## Password Breach Detection

### How It Works

The plugin uses the [Have I Been Pwned Passwords API](https://haveibeenpwned.com/API/v3#PwnedPasswords) with a privacy-preserving k-anonymity model:

1. **Hash the Password**: Creates a SHA-1 hash of the password
2. **Send First 5 Characters**: Only sends the first 5 characters of the hash to the API
3. **Receive Matching Hashes**: The API returns all hashes starting with those 5 characters
4. **Check Locally**: Compares the full hash locally to see if it matches any compromised passwords
5. **Accept or Reject**: Allows the password if not compromised, or returns an error

From `/home/daytona/workspace/source/packages/better-auth/src/plugins/haveibeenpwned/index.ts:13-56`:

```ts
async function checkPasswordCompromise(
  password: string,
  customMessage?: string | undefined,
) {
  if (!password) return;

  const sha1Hash = (
    await createHash("SHA-1", "hex").digest(password)
  ).toUpperCase();
  const prefix = sha1Hash.substring(0, 5);
  const suffix = sha1Hash.substring(5);
  
  try {
    const { data, error } = await betterFetch<string>(
      `https://api.pwnedpasswords.com/range/${prefix}`,
      {
        headers: {
          "Add-Padding": "true",
          "User-Agent": "BetterAuth Password Checker",
        },
      },
    );

    if (error) {
      throw new APIError("INTERNAL_SERVER_ERROR", {
        message: `Failed to check password. Status: ${error.status}`,
      });
    }
    
    const lines = data.split("\n");
    const found = lines.some(
      (line) => line.split(":")[0]!.toUpperCase() === suffix.toUpperCase(),
    );

    if (found) {
      throw new APIError("BAD_REQUEST", {
        message: customMessage || ERROR_CODES.PASSWORD_COMPROMISED,
        code: "PASSWORD_COMPROMISED",
      });
    }
  } catch (error) {
    if (error instanceof APIError) throw error;
    throw new APIError("INTERNAL_SERVER_ERROR", {
      message: "Failed to check password. Please try again later.",
    });
  }
}
```

### Privacy & Security

**Your password never leaves your server in plain text or full hash form:**

- Only the first 5 characters of the SHA-1 hash are sent to the API
- The API returns hundreds of potential matches
- Your server checks locally if the full hash matches
- This prevents the API from knowing which specific password you're checking

**Example:**
- Password: `password123`
- SHA-1 Hash: `482C811DA5D5B4BC6D497FFA98491E38B9C70D9C`
- Sent to API: `482C8` (first 5 characters)
- API returns: All hashes starting with `482C8`
- Your server checks: Does `11DA5D5B4BC6D497FFA98491E38B9C70D9C` match any result?

## Usage Examples

### Basic Implementation

Once configured, the plugin automatically checks passwords:

```ts title="signup.ts"
import { authClient } from "./auth-client";

try {
  await authClient.signUp.email({
    email: "user@example.com",
    password: "password123", // This will be rejected
    name: "John Doe",
  });
} catch (error) {
  if (error.code === "PASSWORD_COMPROMISED") {
    console.error("This password has been compromised in a data breach");
  }
}
```

### Client-Side Error Handling

```tsx title="SignUpForm.tsx"
import { useState } from "react";
import { authClient } from "./auth-client";

export function SignUpForm() {
  const [error, setError] = useState<string>("");

  const handleSubmit = async (e: React.FormEvent<HTMLFormElement>) => {
    e.preventDefault();
    const formData = new FormData(e.currentTarget);

    const result = await authClient.signUp.email({
      email: formData.get("email") as string,
      password: formData.get("password") as string,
      name: formData.get("name") as string,
    });

    if (result.error?.code === "PASSWORD_COMPROMISED") {
      setError(
        "This password has been exposed in a data breach. " +
        "Please choose a different password."
      );
      return;
    }

    if (result.data) {
      // Success!
    }
  };

  return (
    <form onSubmit={handleSubmit}>
      <input type="email" name="email" required />
      <input type="password" name="password" required />
      <input type="text" name="name" required />
      
      {error && <p className="error">{error}</p>}
      
      <button type="submit">Sign Up</button>
    </form>
  );
}
```

### Password Change Protection

```ts title="change-password.ts"
import { authClient } from "./auth-client";

try {
  await authClient.changePassword({
    currentPassword: "oldPassword123",
    newPassword: "newSecurePassword456",
  });
} catch (error) {
  if (error.code === "PASSWORD_COMPROMISED") {
    console.error("The new password you chose has been compromised");
  }
}
```

### Server-Side Usage

```ts title="api/auth/custom-endpoint.ts"
import { auth } from "./auth";

export async function POST(request: Request) {
  const { password } = await request.json();

  try {
    // The plugin will automatically check this password
    await auth.api.signUpEmail({
      body: {
        email: "user@example.com",
        password,
        name: "John Doe",
      },
    });
    
    return Response.json({ success: true });
  } catch (error) {
    if (error.code === "PASSWORD_COMPROMISED") {
      return Response.json(
        { error: "Password has been compromised" },
        { status: 400 }
      );
    }
    throw error;
  }
}
```

## Options

<Properties>
  <Property name="customPasswordCompromisedMessage" type="string">
    Custom error message to display when a password is found to be compromised. Default: `"The password you entered has been compromised. Please choose a different password."`
  </Property>
  <Property name="paths" type="string[]">
    Array of endpoint paths to check for password compromises. Default: `["/sign-up/email", "/change-password", "/reset-password"]`
  </Property>
</Properties>

## Error Handling

The plugin throws an `APIError` with specific properties:

```ts
interface PasswordCompromisedError {
  status: 400;
  code: "PASSWORD_COMPROMISED";
  message: string; // Default or custom message
}
```

Example error handling:

```ts
try {
  await authClient.signUp.email({ email, password, name });
} catch (error) {
  if (error.status === 400 && error.code === "PASSWORD_COMPROMISED") {
    // Show user-friendly message
    alert(error.message);
  } else if (error.status === 500) {
    // API temporarily unavailable
    alert("Could not verify password. Please try again.");
  }
}
```

## Best Practices

1. **Always Check Compromised Passwords**: Enable this plugin in production to protect your users

2. **Combine with Password Strength**: This plugin doesn't validate password strength - consider adding minimum length requirements

```ts
export const auth = betterAuth({
  plugins: [haveIBeenPwned()],
  password: {
    minLength: 8,
    requireNumbers: true,
    requireSpecialChars: true,
  },
});
```

3. **Provide Clear Feedback**: Use custom error messages to guide users

```ts
haveIBeenPwned({
  customPasswordCompromisedMessage:
    "This password was found in a data breach. " +
    "Choose a unique password you haven't used elsewhere.",
})
```

4. **Handle API Failures Gracefully**: The plugin returns 500 errors if the API is unavailable - don't block users permanently

5. **Educate Users**: Explain why their password was rejected and how to choose better passwords

## Performance

- **Fast**: Average response time < 100ms
- **No Database**: No additional database tables required
- **No Rate Limits**: The Have I Been Pwned API is free and has no rate limits
- **Caching**: Consider implementing caching if you have high-volume sign-ups

## Testing

You can test with known compromised passwords:

```ts
// These will be rejected:
"password123"
"123456"
"qwerty"
"abc123"

// This should pass (if not actually compromised):
`SecureP@ssw0rd${Date.now()}`
```