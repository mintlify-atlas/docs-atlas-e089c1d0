---
title: JWT
description: Add JWT token generation, signing, and verification to your authentication system
---

The JWT plugin adds JSON Web Token (JWT) functionality to Better Auth, enabling stateless authentication, token-based API access, and integration with third-party services. It provides automatic JWT generation, signing with JWKS (JSON Web Key Set), and verification capabilities.

## Security Benefits

- **Stateless Authentication**: JWTs can be verified without database lookups
- **Standard Compliance**: Follows RFC 7519 JWT and OpenID Connect standards
- **Key Rotation**: Supports automatic key rotation with grace periods
- **Cryptographic Signing**: Uses EdDSA, RSA, or ECDSA algorithms
- **Claims Validation**: Automatic validation of issuer, audience, expiration, and other claims
- **JWKS Endpoint**: Exposes public keys for third-party JWT verification

## Installation

<Steps>

<Step title="Add the plugin to your Better Auth configuration">

```ts title="auth.ts"
import { betterAuth } from "better-auth";
import { jwt } from "better-auth/plugins";

export const auth = betterAuth({
  plugins: [
    jwt(),
  ],
});
```

</Step>

<Step title="Add the client plugin (optional)">

```ts title="auth-client.ts"
import { createAuthClient } from "better-auth/client";
import { jwtClient } from "better-auth/plugins/jwt/client";

export const authClient = createAuthClient({
  plugins: [jwtClient()],
});
```

</Step>

</Steps>

## Configuration

### Basic Configuration

```ts title="auth.ts"
import { jwt } from "better-auth/plugins";

export const auth = betterAuth({
  plugins: [
    jwt({
      jwt: {
        issuer: "https://yourdomain.com",
        audience: "https://yourdomain.com",
        expiresIn: "1h",
      },
    }),
  ],
});
```

### Custom Signing Algorithm

```ts title="auth.ts"
import { jwt } from "better-auth/plugins";

export const auth = betterAuth({
  plugins: [
    jwt({
      jwks: {
        keyPairConfig: {
          alg: "RS256", // RSA with SHA-256
          modulusLength: 2048,
        },
      },
    }),
  ],
});
```

### Remote JWKS URL

For distributed systems where you want to host JWKS externally:

```ts title="auth.ts"
import { jwt } from "better-auth/plugins";

export const auth = betterAuth({
  plugins: [
    jwt({
      jwks: {
        remoteUrl: "https://keys.yourdomain.com/jwks",
        keyPairConfig: {
          alg: "EdDSA",
        },
      },
    }),
  ],
});
```

### Custom JWT Claims

```ts title="auth.ts"
import { jwt } from "better-auth/plugins";

export const auth = betterAuth({
  plugins: [
    jwt({
      jwt: {
        sign: async (payload, user, session) => {
          return {
            ...payload,
            // Add custom claims
            role: user.role,
            permissions: user.permissions,
            organizationId: user.organizationId,
          };
        },
      },
    }),
  ],
});
```

## JWT Signing and Verification

### Automatic JWT Generation

JWTs are automatically generated and sent in the `set-auth-jwt` header on session creation:

```ts title="client.ts"
const response = await authClient.signIn.email({
  email: "user@example.com",
  password: "password123",
});

// JWT is available in response headers
const jwt = response.headers.get("set-auth-jwt");
```

### Manual JWT Signing

Sign custom JWTs with your own payload:

```ts title="server.ts"
import { auth } from "./auth";

const token = await auth.api.signJWT({
  body: {
    payload: {
      userId: "123",
      role: "admin",
      permissions: ["read", "write"],
    },
  },
});

console.log(token); // { token: "eyJhbGc.." }
```

From the client:

```ts title="client.ts"
const { data } = await authClient.signJWT({
  payload: {
    userId: "123",
    customClaim: "value",
  },
});

console.log(data?.token);
```

### JWT Verification

Verify JWTs on the server:

```ts title="server.ts"
import { auth } from "./auth";
import { verifyJWT } from "better-auth/plugins/jwt";

const payload = await verifyJWT(token);

if (payload) {
  console.log(payload.sub); // User ID
  console.log(payload.aud); // Audience
  console.log(payload.iat); // Issued at
  console.log(payload.exp); // Expires at
}
```

Using the endpoint:

```ts title="server.ts"
const result = await auth.api.verifyJWT({
  body: {
    token: "eyJhbGc...",
  },
});

if (result.payload) {
  console.log(result.payload);
}
```

### Get JWT for Current Session

Retrieve a JWT for an authenticated user:

```ts title="client.ts"
const { data } = await authClient.token();
console.log(data?.token); // JWT string
```

Server-side:

```ts title="server.ts"
const token = await auth.api.getToken({
  headers: {
    authorization: `Bearer ${sessionToken}`,
  },
});
```

## JWKS (JSON Web Key Set)

### Accessing the JWKS Endpoint

The plugin automatically exposes a JWKS endpoint at `/jwks` (configurable):

```bash
curl https://yourdomain.com/api/auth/jwks
```

Response:

```json
{
  "keys": [
    {
      "kid": "key-id-123",
      "kty": "OKP",
      "alg": "EdDSA",
      "use": "sig",
      "crv": "Ed25519",
      "x": "base64url-encoded-public-key"
    }
  ]
}
```

### Using JWKS with Third-Party Services

Many services can verify JWTs using your JWKS endpoint:

```ts title="third-party-service.ts"
import { createRemoteJWKSet, jwtVerify } from "jose";

const JWKS = createRemoteJWKSet(
  new URL("https://yourdomain.com/api/auth/jwks")
);

const { payload } = await jwtVerify(token, JWKS, {
  issuer: "https://yourdomain.com",
  audience: "https://yourdomain.com",
});

console.log(payload);
```

### Custom JWKS Path

```ts title="auth.ts"
jwt({
  jwks: {
    jwksPath: "/custom-jwks",
  },
})
```

## Usage Examples

### API Authentication with JWT

```ts title="api/protected-route.ts"
import { verifyJWT } from "better-auth/plugins/jwt";

export async function GET(request: Request) {
  const authHeader = request.headers.get("authorization");
  const token = authHeader?.replace("Bearer ", "");

  if (!token) {
    return Response.json({ error: "Unauthorized" }, { status: 401 });
  }

  const payload = await verifyJWT(token);

  if (!payload) {
    return Response.json({ error: "Invalid token" }, { status: 401 });
  }

  return Response.json({
    message: "Protected data",
    userId: payload.sub,
  });
}
```

### Middleware for JWT Authentication

```ts title="middleware.ts"
import { NextResponse } from "next/server";
import type { NextRequest } from "next/server";
import { verifyJWT } from "better-auth/plugins/jwt";

export async function middleware(request: NextRequest) {
  const token = request.headers.get("authorization")?.replace("Bearer ", "");

  if (!token) {
    return NextResponse.json(
      { error: "No token provided" },
      { status: 401 }
    );
  }

  const payload = await verifyJWT(token);

  if (!payload) {
    return NextResponse.json(
      { error: "Invalid or expired token" },
      { status: 401 }
    );
  }

  // Add user info to request headers
  const requestHeaders = new Headers(request.headers);
  requestHeaders.set("x-user-id", payload.sub);

  return NextResponse.next({
    request: {
      headers: requestHeaders,
    },
  });
}

export const config = {
  matcher: "/api/protected/:path*",
};
```

### Custom JWT Claims Based on User Data

```ts title="auth.ts"
import { jwt } from "better-auth/plugins";

export const auth = betterAuth({
  plugins: [
    jwt({
      jwt: {
        sign: async (payload, user, session) => {
          // Fetch additional user data
          const userRole = await getUserRole(user.id);
          const organization = await getUserOrganization(user.id);

          return {
            ...payload,
            role: userRole,
            organizationId: organization.id,
            organizationName: organization.name,
            permissions: organization.permissions,
          };
        },
      },
    }),
  ],
});
```

### React Hook for JWT

```tsx title="useJWT.ts"
import { useEffect, useState } from "react";
import { authClient } from "./auth-client";

export function useJWT() {
  const [jwt, setJwt] = useState<string | null>(null);
  const [loading, setLoading] = useState(true);

  useEffect(() => {
    const fetchJWT = async () => {
      const { data } = await authClient.token();
      setJwt(data?.token ?? null);
      setLoading(false);
    };

    fetchJWT();
  }, []);

  return { jwt, loading };
}

// Usage
function ApiClient() {
  const { jwt, loading } = useJWT();

  if (loading) return <div>Loading...</div>;

  const fetchProtectedData = async () => {
    const response = await fetch("/api/protected", {
      headers: {
        authorization: `Bearer ${jwt}`,
      },
    });
    return response.json();
  };

  return <button onClick={fetchProtectedData}>Fetch Data</button>;
}
```

### Automatic JWT Refresh

```ts title="client.ts"
import { authClient } from "./auth-client";

let cachedJWT: string | null = null;
let jwtExpiry: number | null = null;

export async function getValidJWT(): Promise<string> {
  // Check if cached JWT is still valid
  if (cachedJWT && jwtExpiry && Date.now() < jwtExpiry - 60000) {
    return cachedJWT;
  }

  // Fetch new JWT
  const { data } = await authClient.token();
  if (!data?.token) {
    throw new Error("Failed to get JWT");
  }

  // Parse expiry from JWT (simplified)
  const payload = JSON.parse(atob(data.token.split(".")[1]));
  jwtExpiry = payload.exp * 1000;
  cachedJWT = data.token;

  return cachedJWT;
}
```

## Options

<Properties>
  <Property name="jwt.issuer" type="string">
    The issuer claim (`iss`) for generated JWTs. Default: your `baseURL`
  </Property>
  <Property name="jwt.audience" type="string">
    The audience claim (`aud`) for generated JWTs. Default: your `baseURL`
  </Property>
  <Property name="jwt.expiresIn" type="string | number">
    JWT expiration time. Can be a string like `"1h"`, `"30m"`, `"7d"` or seconds as a number. Default: matches session expiration
  </Property>
  <Property name="jwt.sign" type="function">
    Custom function to modify JWT payload before signing
  </Property>
  <Property name="jwks.keyPairConfig" type="object">
    Configuration for key generation:
    - `alg`: Algorithm (`"EdDSA"`, `"RS256"`, `"ES256"`, etc.)
    - `modulusLength`: For RSA keys (2048, 4096)
    - `crv`: Curve name for ECDSA (`"P-256"`, `"P-384"`, `"Ed25519"`)
  </Property>
  <Property name="jwks.jwksPath" type="string">
    Path for the JWKS endpoint. Default: `"/jwks"`
  </Property>
  <Property name="jwks.remoteUrl" type="string">
    URL to remote JWKS for distributed systems
  </Property>
  <Property name="jwks.gracePeriod" type="number">
    Grace period in seconds for expired keys. Default: 30 days
  </Property>
  <Property name="disableSettingJwtHeader" type="boolean">
    Disable automatic JWT header on session creation. Default: `false`
  </Property>
</Properties>

## Key Rotation

The plugin supports automatic key rotation:

```ts title="auth.ts"
import { jwt, createJwk } from "better-auth/plugins";

export const auth = betterAuth({
  plugins: [
    jwt({
      jwks: {
        gracePeriod: 30 * 24 * 60 * 60, // 30 days in seconds
      },
    }),
  ],
});

// Manually create a new key
const ctx = await auth.$context;
await createJwk(ctx, {
  jwks: {
    keyPairConfig: {
      alg: "EdDSA",
    },
  },
});
```

## Best Practices

1. **Use Short Expiration Times**: Keep JWTs short-lived (15-60 minutes) for better security

2. **Implement Token Refresh**: Use session tokens or refresh tokens alongside JWTs

3. **Validate All Claims**: Always verify issuer, audience, and expiration

4. **Use Strong Algorithms**: EdDSA (Ed25519) or RS256 are recommended

5. **Don't Store Sensitive Data**: JWTs are not encrypted, only signed

6. **Implement Key Rotation**: Regularly rotate signing keys

7. **Use HTTPS**: Always transmit JWTs over secure connections

8. **Handle Expired Tokens**: Provide clear error messages and refresh mechanisms